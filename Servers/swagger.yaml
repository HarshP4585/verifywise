openapi: 3.0.0
info:
  title: Compliance Management API
  description: API documentation for the compliance management application
  version: 1.0.0

servers:
  - url: http://localhost:3000
    description: Local development server

paths:
  /subcontrols:
    get:
      tags: [subcontrols]
      security:
        - JWTAuth: []
      responses:
        "200":
          description: list of all sub controls
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
                  data:
                    type: array
                    items:
                      $ref: "#components/schemas/SubControl"
        "204":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: no content
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    post:
      tags: [subcontrols]
      security:
        - JWTAuth: []
      requestBody:
        description: body of the new sub control
        content:
          application/json:
            schema:
              type: object
              properties:
                controlId:
                  type: number
                  example: 1
                status:
                  type: string
                  anyOf:
                    - type: string
                    enum:
                      - "Waiting"
                      - "In progress"
                      - "Done"
                  example: "In Progress"
                approver:
                  type: string
                  example: "John Doe"
                riskReview:
                  type: string
                  anyOf:
                    - type: string
                    enum:
                      - "Acceptable risk"
                      - "Residual risk"
                      - "Unacceptable risk"
                  example: "Acceptable risk"
                owner:
                  type: string
                  example: "Bob Johnson"
                reviewer:
                  type: string
                  example: "Alice Williams"
                dueDate:
                  type: Date
                  example: "2023-12-31T00:00:00.000Z"
                implementationDetails:
                  type: string
                  example: "Implement new feature"
                evidence:
                  type: string
                  example: "evidence1.pdf"
                attachment:
                  type: string
                  example: "attachment1.docx"
                feedback:
                  type: string
                  example: "Great work so far."
        required: true
      responses:
        "201":
          description: new created sub control
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: created
                data:
                  type: object
                  $ref: "#components/schemas/SubControl"
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
        "503":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: service unavailable
                error:
                  type: object
  /subcontrols/{id}:
    get:
      tags: [subcontrols]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the sub control
      responses:
        "200":
          description: sub control
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
                  data:
                    $ref: "#components/schemas/SubControl"
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    put:
      tags: [subcontrols]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the sub control
      requestBody:
        description: body of the new sub control
        content:
          application/json:
            schema:
              type: object
              properties:
                controlId:
                  type: number
                  example: 1
                status:
                  type: string
                  anyOf:
                    - type: string
                    enum:
                      - "Waiting"
                      - "In progress"
                      - "Done"
                  example: "In Progress"
                approver:
                  type: string
                  example: "John Doe"
                riskReview:
                  type: string
                  anyOf:
                    - type: string
                    enum:
                      - "Acceptable risk"
                      - "Residual risk"
                      - "Unacceptable risk"
                  example: "Acceptable risk"
                owner:
                  type: string
                  example: "Bob Johnson"
                reviewer:
                  type: string
                  example: "Alice Williams"
                dueDate:
                  type: Date
                  example: "2023-12-31T00:00:00.000Z"
                implementationDetails:
                  type: string
                  example: "Implement new feature"
                evidence:
                  type: string
                  example: "evidence1.pdf"
                attachment:
                  type: string
                  example: "attachment1.docx"
                feedback:
                  type: string
                  example: "Great work so far."
        required: true
      responses:
        "202":
          description: sub control
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: accepted
                  data:
                    $ref: "#components/schemas/SubControl"
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    delete:
      tags: [subcontrols]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the sub control to delete
      responses:
        "202":
          description: sub control
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: accepted
                  data:
                    type: boolean
                    example: true
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object

  /subtopics:
    get:
      tags: [subtopics]
      security:
        - JWTAuth: []
      responses:
        "200":
          description: list of all sub topics
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
                  data:
                    type: array
                    items:
                      $ref: "#components/schemas/SubTopic"
        "204":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: no content
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    post:
      tags: [subtopics]
      security:
        - JWTAuth: []
      requestBody:
        description: body of the new sub topic
        content:
          application/json:
            schema:
              type: object
              properties:
                topicId:
                  type: integer
                  example: 1
                name:
                  type: string
                  example: "Subtopic A"
        required: true
      responses:
        "201":
          description: new created sub topic
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: created
                data:
                  type: object
                  $ref: "#components/schemas/SubTopic"
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
        "503":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: service unavailable
                error:
                  type: object
  /subtopics/{id}:
    get:
      tags: [subtopics]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the sub topic
      responses:
        "200":
          description: sub topic
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
                  data:
                    $ref: "#components/schemas/SubTopic"
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    put:
      tags: [subtopics]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the sub topic
      requestBody:
        description: body of the new sub topic
        content:
          application/json:
            schema:
              type: object
              properties:
                topicId:
                  type: integer
                  example: 1
                name:
                  type: string
                  example: "Subtopic A"
        required: true
      responses:
        "202":
          description: sub topic
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: accepted
                  data:
                    $ref: "#components/schemas/SubTopic"
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    delete:
      tags: [subtopics]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the sub topic to delete
      responses:
        "202":
          description: sub topic
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: accepted
                  data:
                    type: boolean
                    example: true
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object

  /topics:
    get:
      tags: [topics]
      security:
        - JWTAuth: []
      responses:
        "200":
          description: list of all topics
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
                  data:
                    type: array
                    items:
                      $ref: "#components/schemas/Topic"
        "204":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: no content
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    post:
      tags: [topics]
      security:
        - JWTAuth: []
      requestBody:
        description: body of the new topic
        content:
          application/json:
            schema:
              type: object
              properties:
                assessmentId:
                  type: integer
                  example: 1
                title:
                  type: string
                  example: "Project A"
        required: true
      responses:
        "201":
          description: new created topic
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: created
                data:
                  type: object
                  $ref: "#components/schemas/Topic"
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
        "503":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: service unavailable
                error:
                  type: object
  /topics/{id}:
    get:
      tags: [topics]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the topic
      responses:
        "200":
          description: topic
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: ok
                  data:
                    $ref: "#components/schemas/Topic"
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    put:
      tags: [topics]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the topic
      requestBody:
        description: body of the new topic
        content:
          application/json:
            schema:
              type: object
              properties:
                assessmentId:
                  type: integer
                  example: 1
                title:
                  type: string
                  example: "Project A"
        required: true
      responses:
        "202":
          description: topic
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: accepted
                  data:
                    $ref: "#components/schemas/Topic"
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object
    delete:
      tags: [topics]
      security:
        - JWTAuth: []
      parameters:
        - in: path
          name: id
          schema:
            type: integer
          required: true
          description: id of the topic to delete
      responses:
        "202":
          description: topic
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: accepted
                  data:
                    type: boolean
                    example: true
        "404":
          description: no content to display
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: not found
                data:
                  type: object
        "500":
          description: internal server error
          content:
            application/json:
              type: object
              properties:
                message:
                  type: string
                  example: internal server error
                error:
                  type: object

components:
  securitySchemes:
    JWTAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      value: "Bearer <JWT token here>"
  schemas:
    Assessment:
      type: object
      properties:
        id:
          type: integer
          example: 1
        projectId:
          type: integer
          example: 1
    Control:
      type: object
      properties:
        id:
          type: integer
          example: 1
        ProjectId:
          type: integer
          example: 1
        status:
          type: string
          example: "In Progress"
        approver:
          type: string
          example: "John Doe"
        riskReview:
          type: string
          example: "Acceptable risk"
        owner:
          type: string
          example: "Bob Johnson"
        reviewer:
          type: string
          example: "Alice Williams"
        dueDate:
          type: string
          format: date-time
          example: "2024-09-20T00:00:00.000Z"
        implementationDetails:
          type: string
          example: "Implement new feature"
    Project:
      type: object
      properties:
        id:
          type: number
          example: 1
        project_title:
          type: string
          example: "AI Compliance Checker"
        owner:
          type: string
          example: "Alice"
        users:
          type: 
          example: 
        start_date:
          type: string
          format: date-time
          example: "2023-01-15T00:00:00.000Z"
        ai_risk_classification:
          type: string
          - anyOf:
            type: string
            enum:
              - "high risk"
              - "limited risk"
              - "minimal risk"
          example: "high risk"
        type_of_high_risk_role:
          type: string
          - anyOf:
            type: string
            enum:
              - "deployer"
              - "provider"
              - "distributor"
              - "importer"
              - "product manufacturer"
              - "authorized representative"
          example: "deployer"
        goal:
          type: string
          example: ""To ensure compliance with AI governance standards""
        last_updated:
          type: string
          format: date-time
          example: "2024-10-30T00:00:00.000Z"
        last_updated_by:
          type: string
          example: "Alice"
    ProjectRisk:
      type: object
      properties:
        id:
          type: integer
          example: 1
        project_id:
          type: integer
          example: 1
        risk_name:
          type: string
          example: "Data Privacy Compliance"
        risk_owner:
          type: string
          example: "Alice"
        ai_lifecycle_phase:
          type: string
          example: "Deployment"
        risk_description:
          type: string
          example: "Risk of non-compliance with data privacy regulations."
        risk_category:
          type: string
          example: "Regulatory"
        impact:
          type: string
          example: "High"
        assessment_mapping:
          type: string
          example: "GDPR Compliance Check"
        controls_mapping:
          type: string
          example: "Data Access Controls"
        likelihood:
          type: string
          example: "Moderate"
        severity:
          type: string
          example: "High"
        risk_level_autocalculated:
          type: string
          anyOf:
            - type: string
              enum:
                - "No risk"
                - "Low risk"
                - "Medium risk"
                - "High risk"
                - "Very high risk"
          example: "No risk"
        review_notes:
          type: string
          example: "Need for regular audits."
        mitigation_status:
          type: string
          example: "In Progress"
        current_risk_level:
          type: string
          example: "Medium"
        deadline:
          type: string
          format: date-time
          example: "2024-12-31T00:00:00.000Z"
        mitigation_plan:
          type: string
          example: "Implement data anonymization."
        implementation_strategy:
          type: string
          example: "Anonymize user data in production environments."
        mitigation_evidence_document:
          type: string
          example: "Data_Anonymization_Plan.pdf"
        likelihood_mitigation:
          type: string
          example: "Reduced"
        risk_severity:
          type: string
          example: "Moderate"
        final_risk_level:
          type: string
          example: "Low"
        risk_approval:
          type: string
          example: "Pending"
        approval_status:
          type: string
          example: "Under Review"
        date_of_assessment:
          type: string
          format: date-time
          example: "2024-11-01T00:00:00.000Z"
    ProjectScope:
      type: object
      properties:
        id:
          type: integer
          example: 1
        assessmentId:
          type: integer
          example: 1
        describeAiEnvironment:
          type: string
          example: "This project involves the development of a new AI-powered virtual assistant."
        isNewAiTechnology:
          type: boolean
          example: true
        usesPersonalData:
          type: boolean
          example: true
        projectScopeDocuments:
          type: string
          example: "project-scope-v1.pdf"
        technologyType:
          type: string
          example: "Natural Language Processing"
        hasOngoingMonitoring:
          type: boolean
          example: true
        unintendedOutcomes:
          type: string
          example: "Potential bias in the assistant's responses."
        technologyDocumentation:
          type: string
          example: "technology-documentation.docx"
    Question:
      type: object
      properties:
        id:
          type: number
          example: 1
        subtopicId:
          type: number
          example: 1
        questionText:
          type: string
          example: "What is the purpose of this feature?"
        answerType:
          type: string
          example: "Multiple Choice"
        dropdownOptions:
          type: string
          example: "Option A,Option B,Option C"
        hasFileUpload:
          type: boolean
          example: false
        hasHint:
          type: boolean
          example: true
        isRequired:
          type: boolean
          example: true
        priorityOptions:
          type: string
          example: "High,Medium,Low"
    SubControl:
      type: object
      properties:
        id:
          type: number
          example: 1
        controlId:
          type: number
          example: 1
        status:
          type: string
          anyOf:
            - type: string
            enum:
              - "Waiting"
              - "In progress"
              - "Done"
          example: "In Progress"
        approver:
          type: string
          example: "John Doe"
        riskReview:
          type: string
          anyOf:
            - type: string
            enum:
              - "Acceptable risk"
              - "Residual risk"
              - "Unacceptable risk"
          example: "Acceptable risk"
        owner:
          type: string
          example: "Bob Johnson"
        reviewer:
          type: string
          example: "Alice Williams"
        dueDate:
          type: Date
          example: "2023-12-31T00:00:00.000Z"
        implementationDetails:
          type: string
          example: "Implement new feature"
        evidence:
          type: string
          example: "evidence1.pdf"
        attachment:
          type: string
          example: "attachment1.docx"
        feedback:
          type: string
          example: "Great work so far."
    SubTopic:
      type: object
      properties:
        id:
          type: integer
          example: 1
        topicId:
          type: integer
          example: 1
        name:
          type: string
          example: "Subtopic A"
    Topic:
      type: object
      properties:
        id:
          type: integer
          example: 1
        assessmentId:
          type: integer
          example: 1
        title:
          type: string
          example: "Project A"
    User:
      type: object
      properties:
        id:
          type: integer
          example: 1
        name:
          type: string
          example: "Alice Smith"
        email:
          type: string
          example: "alice.smith@example.com"
        password_hash:
          type: string
          example: "$2b$10$c7Mtd3kRpMjr6VexlxuAleT8Sy3SwPcT.YLCazH5QWBgnATDo5N6O"
        role:
          type: integer
          example: 1
        created_at:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"
        last_login:
          type: string
          format: date-time
          example: "2024-10-01T00:00:00.000Z"
    Vendor:
      type: object
      properties:
        id:
          type: integer
          example: 1
        projectId:
          type: integer
          example: 1
        vendorName:
          type: string
          example: "Vendor A"
        assignee:
          type: string
          example: "John Doe"
        vendorProvides:
          type: string
          example: "Consulting Services"
        website:
          type: string
          example: "www.vendora.com"
        vendorContactPerson:
          type: string
          example: "Jane Smith"
        reviewResult:
          type: string
          example: "Positive"
        reviewStatus:
          type: string
          example: "Completed"
        reviewer:
          type: string
          example: "Bob Johnson"
        riskStatus:
          type: string
          - anyOf:
            type: string
            enum:
              - "Active"
              - "Under review"
              - "Not active"
          example: "Not active"
        reviewDate:
          type: string
          format: date-time
          example: "2023-05-15T00:00:00.000Z"
        riskDescription:
          type: string
          example: "Limited experience with new technology"
        impactDescription:
          type: string
          example: "Potential delays in project timeline"
        impact:
          type: integer
          example: 3
        probability:
          type: number
          example: 0.4
        actionOwner:
          type: string
          example: "Alice Williams"
        actionPlan:
          type: string
          example: "Provide additional training"
        riskSeverity:
          type: integer
          example: 2
        riskLevel:
          type: string
          - anyOf:
            type: string
            enum:
              - "Very high risk"
              - "High risk"
              - "Medium risk"
              - "Low risk"
              - "Very low risk"
          example: "Low risk"
        likelihood:
          type: number
          example: 0.5
    VendorRisk:
      type: object
      properties:
        id:
          type: integer
          example: 1
        project_id:
          type: integer
          example: 1
        vendor_name:
          type: string
          example: "Tech Solutions Inc."
        risk_name:
          type: string
          example: "Data Security"
        owner:
          type: string
          example: "Alice"
        risk_level:
          type: string
          - anyOf:
            type: string
            enum:
              - "No risk"
              - "Low risk"
              - "Medium risk"
              - "High risk"
              - "Very high risk"
          example: "High Risk"
        review_date:
          type: string
          format: date-time
          example: "2024-10-20T00:00:00.000Z"
